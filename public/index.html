<!DOCTYPE html>
<html>
<head>
    <title>Cloud Code & Chat</title>
    <style>
        :root { --bg: #121212; --panel: #1e1e1e; --accent: #007acc; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; height: 100vh; margin: 0; }
        #editor-container { flex: 2; padding: 20px; display: flex; flex-direction: column; border-right: 1px solid #333; }
        #chat-container { flex: 1; padding: 20px; display: flex; flex-direction: column; background: var(--panel); }
        
        textarea { flex-grow: 1; background: #000; color: #00ff00; border: 1px solid #444; padding: 10px; font-family: monospace; resize: none; border-radius: 5px; }
        #chat-box { flex-grow: 1; border: 1px solid #444; overflow-y: auto; padding: 10px; margin-bottom: 10px; background: #161616; border-radius: 5px; }
        
        .controls { margin-bottom: 15px; display: flex; gap: 10px; }
        input[type="text"] { flex-grow: 1; padding: 10px; background: #333; border: none; color: white; border-radius: 5px; }
        .btn { background: var(--accent); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        .file-link { color: #4daafc; text-decoration: none; border-bottom: 1px solid; }
    </style>
</head>
<body>

<div id="editor-container">
    <h2>Code Editor</h2>
    <div class="controls">
        <input type="file" id="filePicker">
        <button class="btn" onclick="upload()">Upload File/Zip</button>
        <button class="btn" style="background:#444" onclick="copyCode()">Copy Code</button>
    </div>
    <textarea id="editor" placeholder="Write or paste code here..."></textarea>
</div>

<div id="chat-container">
    <h2>Group Chat</h2>
    <div id="chat-box" id="chatBox"></div>
    <div class="controls">
        <input type="text" id="chatInput" placeholder="Type a message...">
    </div>
    <button class="btn" style="background:red" onclick="adminWipe()">Wipe Data (Admin)</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const editor = document.getElementById('editor');
    const chatBox = document.getElementById('chat-box');
    const chatInput = document.getElementById('chatInput');

    // Sync Code
    editor.addEventListener('input', () => socket.emit('code-change', editor.value));
    socket.on('code-update', (code) => editor.value = code);

    // Initial Load
    socket.on('init', (data) => {
        editor.value = data.code;
        chatBox.innerHTML = ''; 
        data.messages.forEach(m => addMessage(m));
    });

    // Send Message
    chatInput.addEventListener('keypress', (e) => {
        if(e.key === 'Enter' && chatInput.value) {
            socket.emit('send-msg', chatInput.value);
            chatInput.value = '';
        }
    });

    socket.on('new-msg', (msg) => addMessage(msg));

    function addMessage(html) {
        const div = document.createElement('div');
        div.style.marginBottom = "10px";
        div.innerHTML = html;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Upload Logic
    async function upload() {
        const file = document.getElementById('filePicker').files[0];
        if(!file) return alert("Select a file");
        
        const formData = new FormData();
        formData.append('myFile', file);
        
        await fetch('/upload', { method: 'POST', body: formData });
    }

    function copyCode() {
        navigator.clipboard.writeText(editor.value);
        alert("Code copied to clipboard!");
    }

    function adminWipe() {
        const pw = prompt("Admin Password:");
        socket.emit('admin-delete', pw);
    }
</script>
</body>
</html>
